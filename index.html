<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.8.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <title>Henry</title>
  <style>
    @font-face {
      font-family: 'Array';
      src: url('fonts/Array-Wide.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    body,
    html,
    * {
      cursor: url('media/cursor.cur') 17 15, auto !important;
    }

    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-touch-callout: none;
      -khtml-user-select: none;
      user-select: none;
    }

    #imageBackground,
    .album-art {
      pointer-events: none;
      -webkit-user-drag: none;
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    * {
      cursor: url('media/cursor.cur') 17 15, auto;
    }

    a,
    button,
    .social-link,
    .control-btn,
    #enterOverlay {
      cursor: url('media/cursor.cur') 17 15, pointer;
    }

    #imageBackground {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
      opacity: 1;
    }

    .dots-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      opacity: 1;
      background: transparent url('media/background_dot.png') repeat 0 0;
      pointer-events: none;
    }

    .cards-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) perspective(1000px);
      transform-style: preserve-3d;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      z-index: 2;
      transition: transform 0.175s ease;
    }

    .card,
    .music-card {
      width: 600px;
    }

    .card {
      height: auto;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      border: 3px solid rgba(255, 255, 255, 0.25);
      border-radius: 25px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      position: relative;
      background: transparent;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: inherit;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      opacity: 0;
    }

    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: transparent url('media/background_dot.png') repeat 0 0;
      opacity: 0.5;
      z-index: -1;
      pointer-events: none;
    }

    .profile-section {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      margin-bottom: 15px;
      flex-direction: row;
    }

    .username {
      font-family: 'Array', monospace, sans-serif;
      font-size: 2rem;
      color: rgba(255, 255, 255, 0.75);
      text-shadow: 0 0 12.5px rgba(255, 255, 255, 0.5);
    }

    .interests {
      font-family: 'Outfit', Arial, sans-serif;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1rem;
      line-height: 1.4;
      margin-top: 0;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .timezone-note {
      font-family: 'Outfit', Arial, sans-serif;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      line-height: 1.4;
      margin-top: 0;
      font-weight: 300;
    }

    .views-and-location {
      position: absolute;
      bottom: 15px;
      left: 15px;
      display: flex;
      align-items: center;
      color: rgba(255, 255, 255, 0.7);
      font-family: 'Outfit', Arial, sans-serif;
      font-size: 0.9rem;
      gap: 8px;
      font-weight: 300;
    }

    .views-and-location .divider {
      width: 2px;
      height: 15px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 100px;
      margin: 0 2px;
    }

    .social-icons {
      display: flex;
      gap: 20px;
      margin-top: 30px;
      margin-bottom: 40px;
      justify-content: center;
    }

    .social-link {
      color: rgba(255, 255, 255, 0.7);
      font-size: 3.5rem;
      transition: color 0.3s ease, transform 0.3s ease;
      text-decoration: none;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .social-link:hover {
      color: rgba(255, 255, 255, 0.8);
      transform: scale(1.1);
    }

    .ri-eye-fill,
    .ri-map-pin-2-fill {
      font-size: 1.1rem;
    }

    .music-card {
      height: auto;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      border: 3px solid rgba(255, 255, 255, 0.25);
      border-radius: 25px;
      padding: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      position: relative;
      background: transparent;
    }

    .music-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: transparent url('media/background_dot.png') repeat 0 0;
      opacity: 0.5;
      z-index: -1;
      pointer-events: none;
    }

    .music-player {
      display: flex;
      gap: 15px;
      align-items: center;
      height: 70px;
    }

    .album-art {
      width: 70px;
      height: 70px;
      border-radius: 15px;
      object-fit: cover;
    }

    .music-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .song-info {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }

    .song-title {
      font-family: 'Outfit', sans-serif;
      color: white;
      font-weight: 400;
      font-size: 1.1rem;
    }

    .artist-name {
      font-family: 'Outfit', sans-serif;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
      font-weight: 300;
      margin-top: 2px;
    }

    .music-progress-section {
      display: flex;
      align-items: center;
      gap: 3px;
      margin-top: auto;
    }

    .current-time,
    .total-time {
      font-family: 'Outfit', sans-serif;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.8rem;
      font-weight: 300;
      min-width: 32px;
    }

    .current-time {
      text-align: left;
    }

    .total-time {
      text-align: right;
    }

    .progress-bar {
      flex: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress {
      width: 30%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 2px;
    }

    .music-controls {
      display: flex;
      gap: 2px;
      align-items: center;
    }

    .control-btn {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.8);
      transition: color 0.3s, opacity 0.3s;
      padding: 3px;
      cursor: url('media/cursor.cur') 17 15, pointer !important;
      pointer-events: auto !important;
      /* Ensure clicks go through */
    }

    .control-btn:not(.play-btn) {
      opacity: 0.6;
      font-size: 1.1rem;
      cursor: url('media/cursor.cur') 17 15, pointer !important;
      /* Change from default to pointer */
    }

    .control-btn:not(.play-btn):hover {
      opacity: 0.8;
      color: rgba(255, 255, 255, 0.8);
      transform: none;
    }

    .play-btn:hover {
      color: rgba(255, 255, 255, 0.8);
    }

    .play-btn {
      opacity: 1;
      font-size: 1.75rem;
      cursor: url('media/cursor.cur') 17 15, pointer !important;
    }

    #enterOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 1.5s ease;
      opacity: 1;
    }

    #enterOverlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .enter-content {
      text-align: center;
      color: white;
    }

    .enter-text {
      font-size: 2rem;
      margin-bottom: 20px;
      letter-spacing: 2px;
      text-transform: lowercase;
      font-family: 'Array', monospace, sans-serif;
      font-weight: normal;
    }

    .enter-subtext {
      font-size: 1.2rem;
      opacity: 0.8;
    }

    @font-face {
      font-family: 'ArrayFallback';
      src: local('Courier New'), local('Monaco'), local('Menlo'), local('Consolas'), monospace;
    }

    .card-content,
    .music-player {
      position: relative;
      z-index: 1;
    }

    /* Responsive styles for smaller devices */
    @media (max-width: 768px) {

      .card,
      .music-card {
        width: 85vw;
        max-width: 400px;
        padding: 15px;
      }

      .cards-container {
        width: 100%;
        padding: 0 10px;
      }

      .profile-section {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .profile-icon {
        width: 100px;
        height: 100px;
        padding: 10px;
      }

      .profile-text {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .username {
        font-size: 2rem;
        margin-bottom: 7px;
      }

      .interests {
        font-size: 0.95rem;
        margin-bottom: 4px;
      }

      .timezone-note {
        font-size: 0.85rem;
      }

      .social-icons {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .social-link {
        font-size: 4rem;
      }

      .views-and-location {
        position: relative;
        bottom: auto;
        left: auto;
        margin-top: 15px;
        justify-content: center;
        width: 100%;
      }

      .music-player {
        height: 60px;
      }

      .album-art {
        width: 60px;
        height: 60px;
      }

      .song-title {
        font-size: 1rem;
      }

      .artist-name {
        font-size: 0.85rem;
      }

      .music-controls {
        gap: 1px;
      }

      .play-btn {
        font-size: 1.5rem;
      }

      .control-btn:not(.play-btn) {
        font-size: 1rem;
      }

      .enter-text {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 480px) {

      .card,
      .music-card {
        width: 85vw;
        max-width: 350px;
        padding: 15px 12px;
      }

      .username {
        font-size: 1.6rem;
      }

      .interests {
        font-size: 0.9rem;
      }

      .timezone-note {
        font-size: 0.8rem;
      }

      .social-link {
        font-size: 2.5rem;
      }

      .music-player {
        gap: 10px;
        height: 55px;
      }

      .album-art {
        width: 55px;
        height: 55px;
        border-radius: 12px;
      }

      .song-title {
        font-size: 0.95rem;
      }

      .artist-name {
        font-size: 0.8rem;
      }

      .current-time,
      .total-time {
        font-size: 0.7rem;
        min-width: 28px;
      }

      .enter-text {
        font-size: 1.3rem;
        margin-bottom: 15px;
        letter-spacing: 1px;
      }

      /* Adjust 3D effect for mobile */
      .cards-container {
        transform: translate(-50%, -50%) perspective(800px);
      }

      .cards-container:hover {
        transform: translate(-50%, -50%) perspective(800px);
      }
    }

    /* For very small screens (iPhone SE etc.) */
    @media (max-width: 375px) {

      .card,
      .music-card {
        width: 92vw;
        max-width: 320px;
        padding: 12px;
      }

      .username {
        font-size: 1.5rem;
      }

      .interests {
        font-size: 0.85rem;
      }

      .timezone-note {
        font-size: 0.75rem;
      }

      .social-link {
        font-size: 2rem;
      }

      .music-player {
        height: 50px;
      }

      .album-art {
        width: 50px;
        height: 50px;
      }

      .music-progress-section {
        flex-wrap: wrap;
        gap: 5px;
      }

      .progress-bar {
        order: 1;
        width: 100%;
        margin-top: 5px;
      }

      .current-time,
      .total-time {
        min-width: 25px;
      }
    }

    @media (hover: none) and (pointer: coarse),
    (max-width: 768px) {
      .cards-container {
        transform: translate(-50%, -50%) !important;
        transition: none !important;
      }

      .cards-container:hover {
        transform: translate(-50%, -50%) !important;
      }

      /* Also disable the mousemove event listener for mobile */
      .cards-container {
        pointer-events: none;
        /* Or add a class in JavaScript */
      }

      /* Re-enable pointer events for interactive elements inside */
      .card,
      .music-card,
      .social-link,
      .control-btn {
        pointer-events: auto;
      }
    }

    .profile-icon {
      width: 75px;
      height: 75px;
      padding: 8px;
      color: rgba(255, 255, 255, 0.5);
    }
  </style>
</head>

<body>
  <img id="imageBackground" src="images/background.png" alt="Background">
  <div id="enterOverlay">
    <div class="enter-content">
      <div class="enter-text">click anywhere or dont?</div>
    </div>
  </div>
  <div class="cards-container">
    <div class="card">
      <div class="card-content">
        <div class="profile-section">
          <!-- <img src="images/pfp.jpg" alt="Profile" class="profile-icon"> -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="4 4 16 16" class="profile-icon">
            <path fill="currentColor"
              d="M12 12q-1.65 0-2.825-1.175T8 8q0-1.65 1.175-2.825T12 4q1.65 0 2.825 1.175T16 8q0 1.65-1.175 2.825T12 12Zm-6 8q-.825 0-1.413-.588T4 18v-.8q0-.85.438-1.563T5.6 14.55q1.55-.775 3.15-1.163T12 13q1.65 0 3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2v.8q0 .825-.588 1.413T18 20H6Z">
            </path>
          </svg>
          <div class="profile-text">
            <div class="username">henry</div>
            <div class="interests">gamer, traveler, cinephile</div>
            <div class="timezone-note">my midnight is your 00:00</div>
          </div>
        </div>
      </div>
      <div class="social-icons">
        <a href="https://discord.com/users/1404712063594401894" target="_blank" class="social-link">
          <i class="ri-discord-fill"></i>
        </a>
        <a href="https://youtu.be/dQw4w9WgXcQ" target="_blank" class="social-link">
          <i class="ri-youtube-fill"></i>
        </a>
      </div>
      <div class="views-and-location">
        <i class="ri-eye-fill"></i>
        <span class="count">0</span>
        <div class="divider"></div>
        <i class="ri-map-pin-2-fill"></i>
        <span class="location">Silver City</span>
      </div>
    </div>
    <div class="music-card">
      <audio id="musicPlayer" preload="metadata">
        <source src="musics/Manifest (963hz) - Neffex.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <div class="music-player">
        <img src="images/demo-album-icon.jpg" alt="Album Art" class="album-art">
        <div class="music-content">
          <div class="song-info">
            <div>
              <div class="song-title">Manifest (963hz)</div>
              <div class="artist-name">Neffex</div>
            </div>
            <div class="music-progress-section">
              <div class="current-time">0:00</div>
              <div class="progress-bar">
                <div class="progress"></div>
              </div>
              <div class="total-time">0:00</div>
              <div class="music-controls">
                <button class="control-btn" id="prevBtn"><i class="ri-skip-back-fill"></i></button>
                <button class="control-btn play-btn" id="playBtn"><i class="ri-play-fill"></i></button>
                <button class="control-btn" id="nextBtn"><i class="ri-skip-forward-fill"></i></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    window.env = {
      GITHUB_TOKEN: '',
      GITHUB_USER: '',
      GITHUB_REPO: ''
    };
    const dotsOverlay = document.createElement('div');
    dotsOverlay.className = 'dots-overlay';
    document.body.appendChild(dotsOverlay);
    const enterOverlay = document.getElementById('enterOverlay');
    const imageBackground = document.getElementById('imageBackground');
    const cardsContainer = document.querySelector('.cards-container');
    const checkFontLoad = () => {
      const testText = document.createElement('span');
      testText.style.fontFamily = 'Array, monospace';
      testText.style.fontSize = '40px';
      testText.style.position = 'absolute';
      testText.style.opacity = '0';
      testText.innerHTML = 'mmmmmmmmmmlli';
      document.body.appendChild(testText);
      setTimeout(() => {
        const originalWidth = testText.offsetWidth;
        testText.style.fontFamily = 'monospace';
        setTimeout(() => {
          const fallbackWidth = testText.offsetWidth;
          if (Math.abs(originalWidth - fallbackWidth) < 5) {
            document.querySelector('.enter-text').style.fontFamily = 'monospace, sans-serif';
            document.querySelector('.username').style.fontFamily = 'monospace, sans-serif';
          }
          document.body.removeChild(testText);
        }, 100);
      }, 100);
    };
    const musicPlayer = document.getElementById('musicPlayer');
    const playBtn = document.getElementById('playBtn');
    const currentTimeEl = document.querySelector('.current-time');
    const totalTimeEl = document.querySelector('.total-time');
    const progressBar = document.querySelector('.progress');
    const songTitleEl = document.querySelector('.song-title');
    const currentSong = "musics/Manifest (963hz) - Neffex.mp3";

    function fallbackViewCount() {
      const viewCountEl = document.querySelector('.count');
      const lastViewTime = localStorage.getItem('lastViewTime');
      const now = Date.now();
      const oneHour = 3600000;

      if (!lastViewTime || (now - parseInt(lastViewTime)) > oneHour) {
        let count = parseInt(localStorage.getItem('viewCount') || 0);
        count++;
        viewCountEl.textContent = count;
        localStorage.setItem('viewCount', count.toString());
        localStorage.setItem('lastViewTime', now.toString());
      } else {
        const count = parseInt(localStorage.getItem('viewCount') || 0);
        viewCountEl.textContent = count;
      }
    }

    function getSongInfo(filename) {
      const nameWithoutExt = filename.replace(/\.[^/.]+$/, "");
      const parts = nameWithoutExt.split(' - ');
      return {
        title: parts[0] || nameWithoutExt,
        artist: parts[1] || 'Unknown Artist'
      };
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function updateProgress() {
      const currentTime = musicPlayer.currentTime;
      const duration = musicPlayer.duration;
      if (duration) {
        const progressPercent = (currentTime / duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
        currentTimeEl.textContent = formatTime(currentTime);
        totalTimeEl.textContent = formatTime(duration);
      }
    }

    function loadSong() {
  musicPlayer.src = currentSong;
  
  // Add error handling
  musicPlayer.addEventListener('error', function(e) {
    console.error("Error loading audio:", e);
    console.error("Audio src:", musicPlayer.src);
    console.error("Audio error code:", musicPlayer.error?.code);
    
    // Fallback or show error
    songTitleEl.textContent = "Audio unavailable";
    playBtn.disabled = true;
  });
  
  // Add loadedmetadata event
  musicPlayer.addEventListener('loadedmetadata', function() {
    console.log("Audio loaded successfully, duration:", musicPlayer.duration);
    totalTimeEl.textContent = formatTime(musicPlayer.duration);
  });
  
  const songInfo = getSongInfo(currentSong.split('/').pop());
  songTitleEl.textContent = songInfo.title;
  const artistEl = document.querySelector('.artist-name');
  if (artistEl) artistEl.textContent = songInfo.artist;
  progressBar.style.width = '0%';
  currentTimeEl.textContent = '0:00';
  totalTimeEl.textContent = '0:00';
}

    playBtn.addEventListener('click', () => {
      if (musicPlayer.paused) {
        musicPlayer.play();
        playBtn.innerHTML = '<i class="ri-pause-fill"></i>';
      } else {
        musicPlayer.pause();
        playBtn.innerHTML = '<i class="ri-play-fill"></i>';
      }
    });

    musicPlayer.addEventListener('timeupdate', updateProgress);
    loadSong();

    enterOverlay.addEventListener('click', function () {
  enterOverlay.classList.add('fade-out');
  
  // First ensure the audio is properly loaded
  if (musicPlayer.readyState < 2) { // HAVE_CURRENT_DATA or less
    console.log("Audio not loaded yet, loading...");
    loadSong();
  }
  
  // Set volume to 0 before playing
  musicPlayer.volume = 0;
  
  // Play with better error handling
  const playPromise = musicPlayer.play();
  
  if (playPromise !== undefined) {
    playPromise.then(() => {
      console.log("Audio playback started successfully");
      playBtn.innerHTML = '<i class="ri-pause-fill"></i>';
      
      // Fade in volume
      let vol = 0;
      const fadeInInterval = setInterval(() => {
        vol += 0.05;
        if (vol >= 0.7) {
          vol = 0.7;
          clearInterval(fadeInInterval);
        }
        musicPlayer.volume = vol;
      }, 100);
      
    }).catch(error => {
      console.error("Music autoplay failed:", error);
      console.error("Error details:", {
        name: error.name,
        message: error.message,
        audioSrc: musicPlayer.src,
        audioError: musicPlayer.error
      });
      
      // Try to diagnose the issue
      if (error.name === "NotSupportedError") {
        console.log("The audio format or source might not be supported");
        // Check if the audio element has a source
        if (!musicPlayer.src || musicPlayer.src === window.location.href) {
          console.log("Audio element has no source set");
        }
      }
      
      // Still hide the overlay but don't play music
      playBtn.innerHTML = '<i class="ri-play-fill"></i>';
    });
  }
  
  setTimeout(function () {
    enterOverlay.style.display = 'none';
  }, 1500);
});

    window.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && enterOverlay.style.display !== 'none') {
        enterOverlay.click();
      }
    });

    cardsContainer.addEventListener('mousemove', (e) => {
      const { left, top, width, height } = cardsContainer.getBoundingClientRect();
      const x = (e.clientX - left) / width - 0.5;
      const y = (e.clientY - top) / height - 0.5;
      const tiltX = y * 15;
      const tiltY = -x * 15;
      const lift = Math.abs(x * y) * 20 + 10;
      cardsContainer.style.transform = `translate(-50%, -50%) 
                      perspective(1000px) 
                      rotateX(${tiltX}deg) 
                      rotateY(${tiltY}deg) 
                      translateZ(${lift}px)`;
    });

    cardsContainer.addEventListener('mouseleave', () => {
      cardsContainer.style.transform = 'translate(-50%, -50%) perspective(1000px)';
    });

    cardsContainer.addEventListener('mouseenter', () => {
      cardsContainer.style.cursor = 'pointer';
    });

    // View counter using GitHub API
    async function updateViewCount() {
      const viewCountEl = document.querySelector('.count');
      if (!viewCountEl) return;

      // Fallback to localStorage if GitHub API fails
      const fallbackCount = () => {
        let localCount = parseInt(localStorage.getItem('viewCount') || 0);
        localCount++;
        localStorage.setItem('viewCount', localCount.toString());
        viewCountEl.textContent = localCount;
      };

      try {
        // Get environment variables
        // In production, these would be set during build
        // For development, we'll try to get them from window.env
        const GITHUB_TOKEN = window.env.GITHUB_TOKEN || '';
        const GITHUB_USER = window.env.GITHUB_USER || 'your-username';
        const GITHUB_REPO = window.env.GITHUB_REPO || 'your-repo-name';

        // Don't proceed if we don't have a token
        if (!GITHUB_TOKEN) {
          console.warn('GitHub token not found. Using localStorage fallback.');
          fallbackCount();
          return;
        }

        const FILE_PATH = 'counter.json';

        // 1. Get current count from GitHub
        const getUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`;
        const getResponse = await fetch(getUrl, {
          headers: {
            'Authorization': `token ${GITHUB_TOKEN}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!getResponse.ok) {
          throw new Error(`GitHub API error: ${getResponse.status}`);
        }

        const fileData = await getResponse.json();
        const content = atob(fileData.content.replace(/\n/g, '')); // Decode base64
        const data = JSON.parse(content);
        let count = data.count || 0;

        // Show current count immediately
        viewCountEl.textContent = count;

        // 2. Increment count (but only once per session)
        const sessionKey = 'hasCountedViews';
        if (!sessionStorage.getItem(sessionKey)) {
          count++;
          sessionStorage.setItem(sessionKey, 'true');

          // 3. Update file on GitHub
          const updateUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`;
          const updateResponse = await fetch(updateUrl, {
            method: 'PUT',
            headers: {
              'Authorization': `token ${GITHUB_TOKEN}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              message: `Update view count to ${count}`,
              content: btoa(JSON.stringify({ count: count })),
              sha: fileData.sha
            })
          });

          if (updateResponse.ok) {
            viewCountEl.textContent = count;
          } else {
            console.error('Failed to update count on GitHub');
          }
        }

      } catch (error) {
        console.error('Error with GitHub view counter:', error);
        fallbackCount();
      }
    }

    // Initialize view counter on page load
    window.addEventListener('load', function () {
      checkFontLoad();
      updateViewCount(); // Call Netlify function counter
    });

    setTimeout(checkFontLoad, 1000);

    const passionText = document.querySelector('.timezone-note');
    const updatePassionText = () => {
      const viewerOffset = new Date().getTimezoneOffset();
      const viewerUTChours = -viewerOffset / 60;
      let viewerHour = 23 + viewerUTChours;
      if (viewerHour >= 24) viewerHour -= 24;
      if (viewerHour < 0) viewerHour += 24;
      const viewerMinute = Math.round((viewerHour % 1) * 60);
      viewerHour = Math.floor(viewerHour);
      const ampm = viewerHour >= 12 ? 'pm' : 'am';
      let displayHours = viewerHour % 12;
      displayHours = displayHours ? displayHours : 12;
      const displayMinutes = viewerMinute.toString().padStart(2, '0');
      passionText.textContent = `my midnight is your ${displayHours}:${displayMinutes}${ampm}`;
    };

    updatePassionText();
    setInterval(updatePassionText, 60000);

    // Disable right-click context menu
    document.addEventListener('contextmenu', function (e) {
      e.preventDefault();
    });

    // Or if you want to be more comprehensive and also prevent keyboard shortcuts:
    document.addEventListener('keydown', function (e) {
      // Disable Ctrl+Shift+I (DevTools), Ctrl+Shift+J (Console), Ctrl+U (View Source)
      if (e.ctrlKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'U' || e.key === 'u')) {
        e.preventDefault();
      }
      // Disable F12 key
      if (e.key === 'F12') {
        e.preventDefault();
      }
    });
  </script>
</body>

</html>
